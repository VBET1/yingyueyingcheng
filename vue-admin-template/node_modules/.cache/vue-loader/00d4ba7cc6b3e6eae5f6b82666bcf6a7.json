{"remainingRequest":"C:\\Users\\86180\\Desktop\\vue-admin-template\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\86180\\Desktop\\vue-admin-template\\src\\views\\system\\sysRole\\assignAuth.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\86180\\Desktop\\vue-admin-template\\src\\views\\system\\sysRole\\assignAuth.vue","mtime":1726972637388},{"path":"C:\\Users\\86180\\Desktop\\vue-admin-template\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1726969924886},{"path":"C:\\Users\\86180\\Desktop\\vue-admin-template\\node_modules\\babel-loader\\lib\\index.js","mtime":1726969926736},{"path":"C:\\Users\\86180\\Desktop\\vue-admin-template\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1726969924886},{"path":"C:\\Users\\86180\\Desktop\\vue-admin-template\\node_modules\\vue-loader\\lib\\index.js","mtime":1726969927562}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgYXBpIGZyb20gJ0AvYXBpL21lbnUvbWVudS5qcycNCmV4cG9ydCBkZWZhdWx0IHsNCiAgICBuYW1lOiAncm9sZUF1dGgnLA0KDQogICAgZGF0YSgpIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLCAvLyDnlKjmnaXmoIfor4bmmK/lkKbmraPlnKjkv53lrZjor7fmsYLkuK3nmoTmoIfor4YsIOmYsuatoumHjeWkjeaPkOS6pA0KICAgICAgICAgICAgc3lzTWVudUxpc3Q6IFtdLCAvLyDmiYDmnIkNCiAgICAgICAgICAgIGRlZmF1bHRQcm9wczogew0KICAgICAgICAgICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLA0KICAgICAgICAgICAgICAgIGxhYmVsOiAnbmFtZScNCiAgICAgICAgICAgIH0sDQogICAgICAgIH07DQogICAgfSwNCg0KICAgIGNyZWF0ZWQoKSB7DQogICAgICAgIHRoaXMuZmV0Y2hEYXRhKCkNCiAgICB9LA0KDQogICAgbWV0aG9kczogew0KICAgICAgICAvKg0KICAgICAgICDliJ3lp4vljJYNCiAgICAgICAgKi8NCiAgICAgICAgZmV0Y2hEYXRhKCkgew0KICAgICAgICAgICAgY29uc3Qgcm9sZUlkID0gdGhpcy4kcm91dGUucXVlcnkuaWQNCiAgICAgICAgICAgIGFwaS50b0Fzc2lnbihyb2xlSWQpLnRoZW4ocmVzdWx0ID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBzeXNNZW51TGlzdCA9IHJlc3VsdC5kYXRhDQogICAgICAgICAgICAgICAgdGhpcy5zeXNNZW51TGlzdCA9IHN5c01lbnVMaXN0DQogICAgICAgICAgICAgICAgY29uc3QgY2hlY2tlZElkcyA9IHRoaXMuZ2V0Q2hlY2tlZElkcyhzeXNNZW51TGlzdCkNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0UGVybWlzc2lvbnMoKSBjaGVja2VkSWRzJywgY2hlY2tlZElkcykNCiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLnRyZWUuc2V0Q2hlY2tlZEtleXMoY2hlY2tlZElkcykNCiAgICAgICAgICAgIH0pDQogICAgICAgIH0sDQoNCiAgICAgICAgLyoNCiAgICAgICAg5b6X5Yiw5omA5pyJ6YCJ5Lit55qEaWTliJfooagNCiAgICAgICAgKi8NCiAgICAgICAgZ2V0Q2hlY2tlZElkcyhhdXRocywgaW5pdEFyciA9IFtdKSB7DQogICAgICAgICAgICByZXR1cm4gYXV0aHMucmVkdWNlKChwcmUsIGl0ZW0pID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoaXRlbS5zZWxlY3QgJiYgaXRlbS5jaGlsZHJlbi5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgcHJlLnB1c2goaXRlbS5pZCkNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uY2hpbGRyZW4pIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDaGVja2VkSWRzKGl0ZW0uY2hpbGRyZW4sIGluaXRBcnIpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBwcmUNCiAgICAgICAgICAgIH0sIGluaXRBcnIpDQogICAgICAgIH0sDQoNCiAgICAgICAgLyoNCiAgICAgICAg5L+d5a2Y5p2D6ZmQ5YiX6KGoDQogICAgICAgICovDQogICAgICAgIHNhdmUoKSB7DQogICAgICAgICAgICBkZWJ1Z2dlcg0KICAgICAgICAgICAgLy/ojrflj5bliLDlvZPliY3lrZDoioLngrkNCiAgICAgICAgICAgIC8vY29uc3QgY2hlY2tlZE5vZGVzID0gdGhpcy4kcmVmcy50cmVlLmdldENoZWNrZWROb2RlcygpDQogICAgICAgICAgICAvL+iOt+WPluWIsOW9k+WJjeWtkOiKgueCueWPiueItuiKgueCuQ0KICAgICAgICAgICAgY29uc3QgYWxsQ2hlY2tlZE5vZGVzID0gdGhpcy4kcmVmcy50cmVlLmdldENoZWNrZWROb2RlcyhmYWxzZSwgdHJ1ZSk7DQogICAgICAgICAgICBsZXQgaWRMaXN0ID0gYWxsQ2hlY2tlZE5vZGVzLm1hcChub2RlID0+IG5vZGUuaWQpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coaWRMaXN0KQ0KICAgICAgICAgICAgbGV0IGFzc2dpbk1lbnVWbyA9IHsNCiAgICAgICAgICAgICAgICByb2xlSWQ6IHRoaXMuJHJvdXRlLnF1ZXJ5LmlkLA0KICAgICAgICAgICAgICAgIG1lbnVJZExpc3Q6IGlkTGlzdA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZQ0KICAgICAgICAgICAgYXBpLmRvQXNzaWduKGFzc2dpbk1lbnVWbykudGhlbihyZXN1bHQgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlDQogICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKHJlc3VsdC4kbWVzc2FnZSB8fCAn5YiG6YWN5p2D6ZmQ5oiQ5YqfJykNCiAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL3N5c3RlbS9zeXNSb2xlJyk7DQogICAgICAgICAgICB9KQ0KICAgICAgICB9DQogICAgfQ0KfTsNCg=="},{"version":3,"sources":["assignAuth.vue"],"names":[],"mappings":";;;;;;;;;;;;;;AAcA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"assignAuth.vue","sourceRoot":"src/views/system/sysRole","sourcesContent":["<template>\r\n    <div class=\"app-container\">\r\n        <div style=\"padding: 20px 20px 0 20px;\">\r\n            授权角色：{{ $route.query.roleName }}\r\n        </div>\r\n        <el-tree style=\"margin: 20px 0\" ref=\"tree\" :data=\"sysMenuList\" node-key=\"id\" show-checkbox default-expand-all\r\n            :props=\"defaultProps\" />\r\n        <div style=\"padding: 20px 20px;\">\r\n            <el-button :loading=\"loading\" type=\"primary\" icon=\"el-icon-check\" size=\"mini\" @click=\"save\">保存</el-button>\r\n            <el-button @click=\"$router.push('/system/sysRole')\" size=\"mini\" icon=\"el-icon-refresh-right\">返回</el-button>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\nimport api from '@/api/menu/menu.js'\r\nexport default {\r\n    name: 'roleAuth',\r\n\r\n    data() {\r\n        return {\r\n            loading: false, // 用来标识是否正在保存请求中的标识, 防止重复提交\r\n            sysMenuList: [], // 所有\r\n            defaultProps: {\r\n                children: 'children',\r\n                label: 'name'\r\n            },\r\n        };\r\n    },\r\n\r\n    created() {\r\n        this.fetchData()\r\n    },\r\n\r\n    methods: {\r\n        /*\r\n        初始化\r\n        */\r\n        fetchData() {\r\n            const roleId = this.$route.query.id\r\n            api.toAssign(roleId).then(result => {\r\n                const sysMenuList = result.data\r\n                this.sysMenuList = sysMenuList\r\n                const checkedIds = this.getCheckedIds(sysMenuList)\r\n                console.log('getPermissions() checkedIds', checkedIds)\r\n                this.$refs.tree.setCheckedKeys(checkedIds)\r\n            })\r\n        },\r\n\r\n        /*\r\n        得到所有选中的id列表\r\n        */\r\n        getCheckedIds(auths, initArr = []) {\r\n            return auths.reduce((pre, item) => {\r\n                if (item.select && item.children.length === 0) {\r\n                    pre.push(item.id)\r\n                } else if (item.children) {\r\n                    this.getCheckedIds(item.children, initArr)\r\n                }\r\n                return pre\r\n            }, initArr)\r\n        },\r\n\r\n        /*\r\n        保存权限列表\r\n        */\r\n        save() {\r\n            debugger\r\n            //获取到当前子节点\r\n            //const checkedNodes = this.$refs.tree.getCheckedNodes()\r\n            //获取到当前子节点及父节点\r\n            const allCheckedNodes = this.$refs.tree.getCheckedNodes(false, true);\r\n            let idList = allCheckedNodes.map(node => node.id);\r\n            console.log(idList)\r\n            let assginMenuVo = {\r\n                roleId: this.$route.query.id,\r\n                menuIdList: idList\r\n            }\r\n            this.loading = true\r\n            api.doAssign(assginMenuVo).then(result => {\r\n                this.loading = false\r\n                this.$message.success(result.$message || '分配权限成功')\r\n                this.$router.push('/system/sysRole');\r\n            })\r\n        }\r\n    }\r\n};\r\n</script>"]}]}