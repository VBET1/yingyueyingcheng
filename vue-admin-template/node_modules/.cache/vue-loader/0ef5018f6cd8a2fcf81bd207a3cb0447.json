{"remainingRequest":"D:\\传出\\xm\\第六天\\vue-admin-template\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\传出\\xm\\第六天\\vue-admin-template\\src\\views\\system\\sysRole\\assignAuth.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\传出\\xm\\第六天\\vue-admin-template\\src\\views\\system\\sysRole\\assignAuth.vue","mtime":1727159817258},{"path":"D:\\传出\\xm\\第六天\\vue-admin-template\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1726969924886},{"path":"D:\\传出\\xm\\第六天\\vue-admin-template\\node_modules\\babel-loader\\lib\\index.js","mtime":1726969926736},{"path":"D:\\传出\\xm\\第六天\\vue-admin-template\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1726969924886},{"path":"D:\\传出\\xm\\第六天\\vue-admin-template\\node_modules\\vue-loader\\lib\\index.js","mtime":1726969927562}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgYXBpIGZyb20gJ0AvYXBpL21lbnUvbWVudS5qcycNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ0Fzc2lnbkF1dGgnLA0KDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGxvYWRpbmc6IGZhbHNlLCAvLyDnlKjmnaXmoIfor4bmmK/lkKbmraPlnKjkv53lrZjor7fmsYLkuK3nmoTmoIfor4YsIOmYsuatoumHjeWkjeaPkOS6pA0KICAgICAgc3lzTWVudUxpc3Q6IFtdLCAvLyDmiYDmnIkNCiAgICAgIGRlZmF1bHRQcm9wczogew0KICAgICAgICBjaGlsZHJlbjogJ2NoaWxkcmVuJywNCiAgICAgICAgbGFiZWw6ICduYW1lJw0KICAgICAgfQ0KICAgIH0NCiAgfSwNCg0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuZmV0Y2hEYXRhKCkNCiAgfSwNCg0KICBtZXRob2RzOiB7DQogICAgLyoNCiAgICAgICAg5Yid5aeL5YyWDQogICAgICAgICovDQogICAgZmV0Y2hEYXRhKCkgew0KICAgICAgY29uc3Qgcm9sZUlkID0gdGhpcy4kcm91dGUucXVlcnkuaWQNCiAgICAgIGFwaS50b0Fzc2lnbihyb2xlSWQpLnRoZW4oKHJlc3VsdCkgPT4gew0KICAgICAgICBjb25zdCBzeXNNZW51TGlzdCA9IHJlc3VsdC5kYXRhDQogICAgICAgIHRoaXMuc3lzTWVudUxpc3QgPSBzeXNNZW51TGlzdA0KICAgICAgICBjb25zdCBjaGVja2VkSWRzID0gdGhpcy5nZXRDaGVja2VkSWRzKHN5c01lbnVMaXN0KQ0KICAgICAgICBjb25zb2xlLmxvZygnZ2V0UGVybWlzc2lvbnMoKSBjaGVja2VkSWRzJywgY2hlY2tlZElkcykNCiAgICAgICAgdGhpcy4kcmVmcy50cmVlLnNldENoZWNrZWRLZXlzKGNoZWNrZWRJZHMpDQogICAgICB9KQ0KICAgIH0sDQoNCiAgICAvKg0KICAgICAgICDlvpfliLDmiYDmnInpgInkuK3nmoRpZOWIl+ihqA0KICAgICAgICAqLw0KICAgIGdldENoZWNrZWRJZHMoYXV0aHMsIGluaXRBcnIgPSBbXSkgew0KICAgICAgcmV0dXJuIGF1dGhzLnJlZHVjZSgocHJlLCBpdGVtKSA9PiB7DQogICAgICAgIGlmIChpdGVtLnNlbGVjdCAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgIHByZS5wdXNoKGl0ZW0uaWQpDQogICAgICAgIH0gZWxzZSBpZiAoaXRlbS5jaGlsZHJlbikgew0KICAgICAgICAgIHRoaXMuZ2V0Q2hlY2tlZElkcyhpdGVtLmNoaWxkcmVuLCBpbml0QXJyKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBwcmUNCiAgICAgIH0sIGluaXRBcnIpDQogICAgfSwNCg0KICAgIC8qDQogICAgICAgIOS/neWtmOadg+mZkOWIl+ihqA0KICAgICAgICAqLw0KICAgIHNhdmUoKSB7DQogICAgICBkZWJ1Z2dlcg0KICAgICAgLy8g6I635Y+W5Yiw5b2T5YmN5a2Q6IqC54K5DQogICAgICAvLyBjb25zdCBjaGVja2VkTm9kZXMgPSB0aGlzLiRyZWZzLnRyZWUuZ2V0Q2hlY2tlZE5vZGVzKCkNCiAgICAgIC8vIOiOt+WPluWIsOW9k+WJjeWtkOiKgueCueWPiueItuiKgueCuQ0KICAgICAgY29uc3QgYWxsQ2hlY2tlZE5vZGVzID0gdGhpcy4kcmVmcy50cmVlLmdldENoZWNrZWROb2RlcyhmYWxzZSwgdHJ1ZSkNCiAgICAgIGxldCBpZExpc3QgPSBhbGxDaGVja2VkTm9kZXMubWFwKChub2RlKSA9PiBub2RlLmlkKQ0KICAgICAgY29uc29sZS5sb2coaWRMaXN0KQ0KICAgICAgbGV0IGFzc2dpbk1lbnVWbyA9IHsNCiAgICAgICAgcm9sZUlkOiB0aGlzLiRyb3V0ZS5xdWVyeS5pZCwNCiAgICAgICAgbWVudUlkTGlzdDogaWRMaXN0DQogICAgICB9DQogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlDQogICAgICBhcGkuZG9Bc3NpZ24oYXNzZ2luTWVudVZvKS50aGVuKChyZXN1bHQpID0+IHsNCiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKHJlc3VsdC4kbWVzc2FnZSB8fCAn5YiG6YWN5p2D6ZmQ5oiQ5YqfJykNCiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9zeXN0ZW0vc3lzUm9sZScpDQogICAgICB9KQ0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["assignAuth.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"assignAuth.vue","sourceRoot":"src/views/system/sysRole","sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <div style=\"padding: 20px 20px 0 20px\">\r\n      授权角色：{{ $route.query.roleName }}\r\n    </div>\r\n    <el-tree\r\n      style=\"margin: 20px 0\"\r\n      ref=\"tree\"\r\n      :data=\"sysMenuList\"\r\n      node-key=\"id\"\r\n      show-checkbox\r\n      default-expand-all\r\n      :props=\"defaultProps\"\r\n    />\r\n    <div style=\"padding: 20px 20px\">\r\n      <el-button\r\n        :loading=\"loading\"\r\n        type=\"primary\"\r\n        icon=\"el-icon-check\"\r\n        size=\"mini\"\r\n        @click=\"save\"\r\n      >保存</el-button>\r\n      <el-button\r\n        size=\"mini\"\r\n        icon=\"el-icon-refresh-right\"\r\n        @click=\"$router.push('/system/sysRole')\"\r\n      >返回</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport api from '@/api/menu/menu.js'\r\nexport default {\r\n  name: 'AssignAuth',\r\n\r\n  data() {\r\n    return {\r\n      loading: false, // 用来标识是否正在保存请求中的标识, 防止重复提交\r\n      sysMenuList: [], // 所有\r\n      defaultProps: {\r\n        children: 'children',\r\n        label: 'name'\r\n      }\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.fetchData()\r\n  },\r\n\r\n  methods: {\r\n    /*\r\n        初始化\r\n        */\r\n    fetchData() {\r\n      const roleId = this.$route.query.id\r\n      api.toAssign(roleId).then((result) => {\r\n        const sysMenuList = result.data\r\n        this.sysMenuList = sysMenuList\r\n        const checkedIds = this.getCheckedIds(sysMenuList)\r\n        console.log('getPermissions() checkedIds', checkedIds)\r\n        this.$refs.tree.setCheckedKeys(checkedIds)\r\n      })\r\n    },\r\n\r\n    /*\r\n        得到所有选中的id列表\r\n        */\r\n    getCheckedIds(auths, initArr = []) {\r\n      return auths.reduce((pre, item) => {\r\n        if (item.select && item.children.length === 0) {\r\n          pre.push(item.id)\r\n        } else if (item.children) {\r\n          this.getCheckedIds(item.children, initArr)\r\n        }\r\n        return pre\r\n      }, initArr)\r\n    },\r\n\r\n    /*\r\n        保存权限列表\r\n        */\r\n    save() {\r\n      debugger\r\n      // 获取到当前子节点\r\n      // const checkedNodes = this.$refs.tree.getCheckedNodes()\r\n      // 获取到当前子节点及父节点\r\n      const allCheckedNodes = this.$refs.tree.getCheckedNodes(false, true)\r\n      let idList = allCheckedNodes.map((node) => node.id)\r\n      console.log(idList)\r\n      let assginMenuVo = {\r\n        roleId: this.$route.query.id,\r\n        menuIdList: idList\r\n      }\r\n      this.loading = true\r\n      api.doAssign(assginMenuVo).then((result) => {\r\n        this.loading = false\r\n        this.$message.success(result.$message || '分配权限成功')\r\n        this.$router.push('/system/sysRole')\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}